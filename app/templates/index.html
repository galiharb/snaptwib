{% extends 'base.html' %}

{% block content %}

<div class="main">
    <div class="bg-header text-center text-dark p-2">
        <h2>snaptwib.com</h2>
    </div>
    <div class="container mt-2 ">
        <!-- iklan dikit -->
        <div id="carouselExampleAutoplaying" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner radius">
                <div class="carousel-item active">
                    <a href="http://instagram.com/galih.arb" target="_blank">
                        <img src="{{ url_for('static', filename='img/1.gif') }}" class="d-block w-100" alt="...">
                    </a>
                </div>
                <div class="carousel-item">
                    <img src="{{ url_for('static', filename='img/2.gif') }}" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                    <a href="https://saweria.co/galiharb" target="_blank">
                        <img src="{{ url_for('static', filename='img/3.gif') }}" class="d-block w-100" alt="...">
                    </a>
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying"
                data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying"
                data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
        <!-- iklan dikit -->

        <!-- konten -->
        <figure class="mt-3">
            <blockquote class="blockquote">
                <h3>Ada yang baru nih !!!</h3>
            </blockquote>
            <figcaption class="blockquote-footer">
                Apaan tuch ???
            </figcaption>
        </figure>

        <div class="grid" id="twibbons-container" data-page="1">
            {% for twibbon in twibbons %}
            <!-- modal -->
            <div class="modal fade" id="{{ twibbon.id_twibbon }}" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">{{ twibbon.title_twibbon }}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p>Pilih Mode Twibbon :</p>
                            <div class="d-flex justify-content-center">
                                <button type="button" class="btn bg-header m-1 w-50" onclick="window.location.href='{{ url }}/{{ twibbon.id_twibbon }}/twibbonfoto';">
                                    <img src="{{ url_for('static', filename='img/twibbon-foto-button.jpg') }}" style="width: 100%;" alt="">
                                </button>
                                <button type="button" class="btn bg-header m-1 w-50" onclick="window.location.href='{{ url }}/{{ twibbon.id_twibbon }}/twibbonvideo';">
                                    <img src="{{ url_for('static', filename='img/twibbon-video-button.gif') }}"
                                        style="width: 100%;" alt="">
                                </button>
                            </div>
                            <hr>
                            sharelink gan :
                            <div class="input-group mt-3">
                                <span onclick="copyToClipboard_{{ twibbon.id_twibbon }}()" class="input-group-text">
                                    <i class="bi bi-clipboard"></i>
                                </span>
                                <label tabindex="0" class="form-control">
                                    <input class="form-control" type="text" id="url{{ twibbon.id_twibbon }}"
                                        value="{{url}}/{{ twibbon.id_twibbon }}"
                                        aria-label="readonly input example" readonly>
                                </label>
                            </div>
                            <script>
                                function copyToClipboard_{{ twibbon.id_twibbon }} () {
                                    var url = document.getElementById('url{{ twibbon.id_twibbon }}');
                                    url.select();
                                    document.execCommand('copy');
                                }
                            </script>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end modal -->
            <!-- start konten twibbon -->
            <div class="item" data-bs-toggle="modal" data-bs-target="#{{ twibbon.id_twibbon }}">
                <img src="/twb/{{ twibbon.id_twibbon }}.png">
                <div class="card-body mt-4">
                    <h4 class="text-monospace text-muted">{{ twibbon.title_twibbon }}</h4>
                    <a href="/kreator/{{ twibbon.username }}" class="text-decoration-none">
                        <p class="card-text"><i class="bi bi-person-bounding-box"></i> {{ twibbon.username }}</p>
                    </a>
                </div>
            </div>
            <!-- end of konten twibbon -->
            {% endfor %}
        </div>
        <br>
        <center>
            <button id="load-more-btn" class="btn btn-warning">Load more</button>
        </center>
    </div>
    <br><br><br><br><br>
    <!-- konten -->
</div>
<script>
$(document).ready(function() {
  var page = 1;
  var loading = false;
  var loadMoreBtn = $('#load-more-btn');
  var twibbonsContainer = $('#twibbons-container');

  loadMoreBtn.on('click', function() {
    if (!loading) {
      loading = true;
      loadMoreBtn.html('Loading...');

      $.ajax({
        url: '/twibbons?page=' + (page + 1),
        method: 'GET',
        success: function(data) {
          var twibbons = data.twibbons;
          var hasMore = data.has_next;

          for (var i = 0; i < twibbons.length; i++) {
            var twibbon = twibbons[i];
            var twibbonHtml = `
              <!-- modal -->
              <div class="modal fade" id="${twibbon.id_twibbon}" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">${twibbon.title_twibbon}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p>Pilih Mode Twibbon :</p>
                            <div class="d-flex justify-content-center">
                                <button type="button" class="btn bg-header m-1 w-50" onclick="window.location.href='{{ url }}/${twibbon.id_twibbon}/twibbonfoto';">
                                    <img src="{{ url_for('static', filename='img/twibbon-foto-button.jpg') }}" style="width: 100%;" alt="">
                                </button>
                                <button type="button" class="btn bg-header m-1 w-50" onclick="window.location.href='{{ url }}/${twibbon.id_twibbon}/twibbonvideo';">
                                    <img src="{{ url_for('static', filename='img/twibbon-video-button.gif') }}"
                                        style="width: 100%;" alt="">
                                </button>
                            </div>
                            <hr>
                            sharelink gan :
                            <div class="input-group mt-3">
                                <span onclick="var url=document.getElementById('url${twibbon.id_twibbon}');url.select();document.execCommand('copy');" class="input-group-text">
                                    <i class="bi bi-clipboard"></i>
                                </span>
                                <label tabindex="0" class="form-control">
                                    <input class="form-control" type="text" id="url${twibbon.id_twibbon}"
                                        value="{{url}}/${twibbon.id_twibbon}"
                                        aria-label="readonly input example" readonly>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
              </div>
              <!-- end modal -->
              <!-- start konten twibbon -->
              <div class="item" data-bs-toggle="modal" data-bs-target="#${twibbon.id_twibbon}">
                <img src="/twb/${twibbon.id_twibbon}.png">
                <div class="card-body mt-4">
                  <h4 class="text-monospace text-muted">${twibbon.title_twibbon}</h4>
                  <a href="/kreator/${twibbon.username}" class="text-decoration-none">
                    <p class="card-text"><i class="bi bi-person-bounding-box"></i> ${twibbon.username}</p>
                  </a>
                </div>
              </div>
              <!-- end of konten twibbon -->`;

            twibbonsContainer.append(twibbonHtml);
          }
          page++;

          if (!hasMore) {
            loadMoreBtn.hide();
          }

          loading = false;
          loadMoreBtn.html('Load more');
        },
        error: function(jqXHR, textStatus, errorThrown) {
          console.log(errorThrown);
          loading = false;
          loadMoreBtn.html('Load more');
        }
      });
    }
  });
});
</script>


{% endblock %}